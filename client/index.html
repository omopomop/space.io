<canvas id="ctx" width="600" height="600" style="border:1px
solid #000000;"></canvas>

<script src="http://cdn.socket.io/socket.io-1.4.5.js"
></script>
<script>

	//image container
	var Img = {};
	Img.map = new Image();
	Img.map.src = '/client/img/map.png';
	Img.ship = new Image();
	Img.ship.src = '/client/img/ship.png';
	Img.star = new Image();
	Img.star.src = '/client/img/star.png';
	
	var ctx = document.getElementById("ctx").getContext("2d");
	ctx.font = '30px Arial';
	ctx.fillStyle = 'white';
	
	var Player = function(iPack){
		var self = {};
		self.id = iPack.id;
		self.number = iPack.number;
		self.x = iPack.x;
		self.y = iPack.y;
		Player.list[self.id] = self;
		return self;
	}
	Player.list = {};
	
	var Star = function(iPack){
		var self = {};
		self.id = iPack.id;
		self.x = iPack.x;
		self.y = iPack.y;
		Star.list[self.id] = self;
		return self;
	}
	Star.list = {};
	
	var socket = io();
	
	socket.on('init',function(data){
		
		for(var i = 0; i < data.player.length; i++){
			new Player(data.player[i]);
			//socket.emit('playercreated');
		}
		for(var i = 0; i < data.star.length; i++){
			new Star(data.star[i]);
		}
	});
	
	socket.on('update',function(data){
		for(var i = 0; i < data.player.length; i++){
			var pack = data.player[i];
			var p = Player.list[pack.id];
			if(p){
				if(pack.x !== undefined)
					p.x = pack.x;
				if(pack.y !== undefined)
					p.y = pack.y;
			}
		}
		for(var i = 0; i < data.star.length; i++){
			var pack = data.star[i];
			var s = Star.list[pack.id];
			if(s){
				if(pack.x !== undefined)
					s.x = pack.x;
				if(pack.y !== undefined)
					s.y = pack.y;
			}
		}
	});
	
	socket.on('delete',function(data){
		for(var i = 0; i < data.player.length; i++)
			delete Player.list[data.player[i]];
		for(var i = 0; i < data.star.length; i++)
			delete Star.list[data.star[i]];
	});
	
	setInterval(function(){
		ctx.clearRect(0,0,600,600);
		drawMap();
		for(var i in Player.list){
			ctx.drawImage(Img.ship,0,0,Img.ship.width,Img.ship.height,Player.list[i].x-25,Player.list[i].y-30,70,50);
			//ctx.drawImage(Img.ship,Player.list[i].x,Player.list[i].y,Img.ship.width,Img.ship.height,Player.list[i].x,Player.list[i].y,50,50);
			ctx.fillText(Player.list[i].number,Player.list[i].x,Player.list[i].y);
		}
		for(var i in Star.list)
			ctx.drawImage(Img.star,0,0,Img.star.width,Img.star.height,Star.list[i].x,Star.list[i].y,20,20);
			ctx.fillRect(Star.list[i].x-2,Star.list[i].y-2,4,4);
	},40);
		
	var drawMap = function(){
		ctx.drawImage(Img.map,0,0);
	}
	
	document.onkeydown = function(event){
		if(event.keyCode === 68)
			socket.emit('keyPress',{inputId:'r',state:true});
		else if(event.keyCode === 83)
			socket.emit('keyPress',{inputId:'d',state:true});
		else if(event.keyCode === 65)
			socket.emit('keyPress',{inputId:'l',state:true});
		else if(event.keyCode === 87)
			socket.emit('keyPress',{inputId:'u',state:true});
	}
	
	document.onkeyup = function(event){
		if(event.keyCode === 68)
			socket.emit('keyPress',{inputId:'r',state:false});
		else if(event.keyCode === 83)
			socket.emit('keyPress',{inputId:'d',state:false});
		else if(event.keyCode === 65)
			socket.emit('keyPress',{inputId:'l',state:false});
		else if(event.keyCode === 87)
			socket.emit('keyPress',{inputId:'u',state:false});
	}
</script>